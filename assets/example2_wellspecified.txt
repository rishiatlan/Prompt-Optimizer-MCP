â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EXAMPLE 2: Well-Specified Prompt
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Raw prompt: "Refactor the authentication middleware in src/auth/middleware.ts to use JWT toke..."

Quality Score:  81/100  â†’  90/100  (+9)
State:          COMPILED
Risk Level:     high
Task Type:      refactor
Model Rec:      opus
Reason:         High-risk task â€” maximum capability recommended for safety.

â”€â”€ Quality Breakdown (Before) â”€â”€
         Clarity: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 20/20
                 â†³ Goal is well-scoped
     Specificity: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 15/20
                 â†³ 2 file path(s) referenced (+10)
    Completeness: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 18/20
                 â†³ 2 explicit success criteria (+10)
                 â†³ Task type detected: refactor (+3)
     Constraints: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 10/20
                 â†³ 1 forbidden action(s) (+5)
      Efficiency: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 18/20
                 â†³ ~70 tokens â€” efficient

Blocking Questions: 0
Assumptions:        0

â”€â”€ Detected Inputs â”€â”€
  ğŸ“„ src/auth/middleware.ts
  ğŸ“„ auth.test.ts

â”€â”€ Extracted Constraints â”€â”€
  ğŸš« Do not touch the user model or the database layer

â”€â”€ Changes Made â”€â”€
  âœ“ Added: role definition (refactor)
  âœ“ Extracted: single-sentence goal from prompt
  âœ“ Added: 2 success criteria
  âœ“ Added: high-risk safety constraints
  âœ“ Added: universal safety constraints
  âœ“ Added: refactor workflow (4 steps)
  âœ“ Standardized: output format
  âœ“ Added: uncertainty policy (ask, don't guess)

â”€â”€ Cost Estimate â”€â”€
   haiku: $0.001810
  sonnet: $0.006789
    opus: $0.033945

â”€â”€ Compiled Prompt (first 30 lines) â”€â”€
  <role>
  You are a refactoring specialist who improves code structure while preserving behavior.
  </role>
  
  <goal>
  Refactor the authentication middleware in src/auth/middleware
  </goal>
  
  <definition_of_done>
    - should be replaced with validateJWT()
    - Must pass all existing tests in auth
  </definition_of_done>
  
  <constraints>
    - Forbidden: Do not touch the user model or the database layer
    - Do not modify files or code outside the stated scope
    - Do not invent requirements that were not stated
    - Prefer minimal changes over sweeping rewrites
    - HIGH RISK â€” double-check every change before applying
    - Explain the reasoning behind each change
  </constraints>
  
  <workflow>
    1. Understand current behavior and ensure it is preserved
    2. Identify the structural improvements to make
    3. Apply changes incrementally, verifying behavior at each step
    4. Confirm the refactored code passes all existing tests
  </workflow>
  
  <output_format>
  ... (8 more lines)
